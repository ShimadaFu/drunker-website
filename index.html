<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drunker - 醉语钟楼</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Apple 风格字体栈 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
            background-color: #000000;
            color: #f5f5f7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* 自定义动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* 隐藏滚动条 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 图标组件 ---
        const Icons = {
            Ghost: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 22v-2"/><path d="M9 12a4 4 0 1 1 8 0v10"/><path d="M5 22v-2"/><path d="M5 12a8 8 0 0 1 16 0v10"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ArrowLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            FileJson: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
        };

        // --- 数据 ---
        const MOCK_SCRIPTS = [
            {
                id: 'liar_game_001',
                title: '欺诈游戏 (Liar Game)',
                author: '小付',
                frontImgUrl: 'https://i.postimg.cc/N9Wgbjw3/Liargame-cover.png',
                backImgUrl: 'https://i.postimg.cc/wyS6Fjdr/Liargame.png',
                jsonContent: `[
    {
        "id": "_meta",
        "name": "LiarGame",
        "description": "",
        "author": "小付",
        "logo": "https://i.postimg.cc/DZqK2wHY/image.png",
        "state": []
    },
    { "id": "investigator" }, { "id": "empath" }, { "id": "chambermaid" }, { "id": "gambler" },
    { "id": "gossip" }, { "id": "clockmaker" }, { "id": "flowergirl" }, { "id": "king" },
    { "id": "atheist" }, { "id": "alsaahir" }, { "id": "daoshi" }, { "id": "fengshuishi" },
    { "id": "zhifu" }, { "id": "saint" }, { "id": "lunatic" }, { "id": "hermit" },
    { "id": "jiubao" }, { "id": "pit-hag" }, { "id": "goblin" }, { "id": "widow" },
    { "id": "boffin" }, { "id": "fang_gu" }, { "id": "taotie" },
    {
        "id": "diyRole1",
        "name": "观察者",
        "ability": "每局游戏限一次，在夜晚时*，你可以选择一名死亡玩家：如果他是善良的，你获得他的能力；如果他是邪恶的，你中毒。",
        "team": "townsfolk",
        "sch_team": "镇民",
        "firstNight": "",
        "otherNight": "401",
        "firstNightReminder": "",
        "otherNightReminder": "选择一个玩家，获得能力。类似主动限一次的食人族。",
        "reminders": ["已发动技能", "中毒"],
        "remindersGlobal": ["是观察者"],
        "setup": 0,
        "image": "https://i.postimg.cc/tCF9X2Q4/image.png"
    },
    {
        "id": "diyRole2",
        "name": "腐蚀者",
        "ability": "在你的首个夜晚，选择一名玩家，他可能被当做邪恶阵营和恶魔，即使他已死亡。\\n如果他是唯一存活的善良玩家，他转变为邪恶阵营（但他不知道）。",
        "team": "minion",
        "sch_team": "爪牙",
        "firstNight": "4701",
        "otherNight": "",
        "firstNightReminder": "选择",
        "otherNightReminder": "",
        "reminders": ["被腐蚀", "邪恶"],
        "remindersGlobal": [],
        "setup": 0,
        "image": "https://i.postimg.cc/7hTQnsMG/by.png"
    },
    {
        "id": "diyRole3",
        "name": "检察官",
        "ability": "如果你在白天发起过提名，当晚，你会得知一名与被提名者相同阵营的玩家。",
        "team": "townsfolk",
        "sch_team": "镇民",
        "firstNight": "",
        "otherNight": "10499",
        "firstNightReminder": "",
        "otherNightReminder": "得知",
        "reminders": ["提名", "被查验"],
        "remindersGlobal": [],
        "setup": 0,
        "image": "https://i.postimg.cc/tCF9X2Q4/image.png"
    },
    {
        "id": "diyRole4",
        "name": "少数决",
        "ability": "游戏的最后一天，改为得票最少的玩家被处决。",
        "team": "fabled",
        "sch_team": "传奇角色",
        "firstNight": "",
        "otherNight": "",
        "firstNightReminder": "",
        "otherNightReminder": "",
        "reminders": [],
        "remindersGlobal": [],
        "setup": 0,
        "image": "https://i.postimg.cc/RFvgHCqY/Y.png"
    },
    {
        "id": "diyRole5",
        "name": "谈判室",
        "ability": "两名玩家可以自愿向说书人发起秘密交易。说书人受理后生效。违反交易的玩家会有不好的事情发生。\\n每局每名玩家限一次，恶魔不会因此受到惩罚。",
        "team": "fabled",
        "sch_team": "传奇角色",
        "firstNight": "",
        "otherNight": "",
        "firstNightReminder": "",
        "otherNightReminder": "",
        "reminders": ["谈判", "惩罚"],
        "remindersGlobal": [],
        "setup": 0,
        "image": "https://i.postimg.cc/sDMwSND3/image.png"
    }
]`,
                updatedAt: new Date()
            }
        ];

        // --- 主程序 ---
        function App() {
            const [view, setView] = useState('home'); 
            const [scripts] = useState(MOCK_SCRIPTS);
            const [selectedScript, setSelectedScript] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');

            // 搜索过滤
            const filteredScripts = scripts.filter(s => 
                s.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                s.author.toLowerCase().includes(searchQuery.toLowerCase())
            );

            // 路由处理
            const goHome = () => { setView('home'); setSelectedScript(null); };
            const goToDetails = (script) => { setSelectedScript(script); setView('details'); };

            // 下载逻辑
            const handleDownload = (script) => {
                const blob = new Blob([script.jsonContent], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                // 尝试提取 JSON 中的名字
                try {
                    const json = JSON.parse(script.jsonContent);
                    const meta = json.find(i => i.id === "_meta");
                    a.download = (meta && meta.name ? meta.name : script.title) + ".json";
                } catch(e) {
                    a.download = script.title + ".json";
                }
                a.click();
            };

            return (
                <div className="min-h-screen bg-black text-[#f5f5f7] flex flex-col">
                    {/* 导航栏 */}
                    <nav className="fixed top-0 w-full z-50 backdrop-blur-xl bg-black/70 border-b border-white/5 transition-all duration-300">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer group" onClick={goHome}>
                                <div className="p-2 rounded-full bg-indigo-500/20 text-indigo-400 group-hover:bg-indigo-500 group-hover:text-white transition-all duration-300">
                                    <Icons.Ghost />
                                </div>
                                <div className="flex flex-col">
                                    <span className="font-bold text-xl tracking-tight text-white">Drunker</span>
                                    <span className="text-[10px] text-neutral-500 uppercase tracking-widest font-semibold">Blood on the Clocktower</span>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* 顶部占位 */}
                    <div className="h-20"></div>

                    {/* 主内容区 */}
                    <main className="flex-grow max-w-7xl mx-auto px-6 py-8 w-full">
                        {view === 'home' && (
                            <div className="animate-fadeIn">
                                {/* Hero 区域 */}
                                <div className="py-10 text-center space-y-4">
                                    <h1 className="text-4xl md:text-6xl font-bold tracking-tight text-white drop-shadow-2xl">
                                        醉语钟楼
                                    </h1>
                                    <p className="text-lg text-neutral-400 max-w-2xl mx-auto">
                                        精选原创剧本库
                                    </p>
                                    
                                    {/* 搜索框 */}
                                    <div className="relative max-w-md mx-auto mt-8 group">
                                        <input
                                            type="text"
                                            placeholder="搜索剧本..."
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            className="w-full bg-[#1c1c1e] border border-white/10 rounded-full py-3 pl-12 pr-6 focus:outline-none focus:ring-1 focus:ring-indigo-500 text-white placeholder-neutral-600 transition-all text-sm"
                                        />
                                        <div className="absolute left-4 top-3 text-neutral-600"><Icons.Search /></div>
                                    </div>
                                </div>

                                {/* 卡片网格 */}
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-8">
                                    {filteredScripts.map(script => (
                                        <div key={script.id} onClick={() => goToDetails(script)} className="group bg-[#1c1c1e] rounded-2xl overflow-hidden cursor-pointer hover:bg-[#2c2c2e] transition-all duration-300 ring-1 ring-white/5 hover:ring-white/20 hover:scale-[1.02] flex flex-col">
                                            {/* 图片区域 - 强制 1414x2000 比例 (aspect-[0.707]) */}
                                            <div className="relative w-full aspect-[1414/2000] overflow-hidden bg-black/50">
                                                <img 
                                                    src={script.frontImgUrl} 
                                                    className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
                                                    alt={script.title} 
                                                />
                                            </div>
                                            
                                            {/* 内容区域 */}
                                            <div className="p-4">
                                                <h3 className="text-lg font-bold text-white mb-1 line-clamp-1">{script.title}</h3>
                                                <div className="flex justify-between items-center text-xs text-neutral-500">
                                                    <span className="flex items-center gap-1.5"><Icons.User size={12} /> {script.author}</span>
                                                    <span>{script.updatedAt.toLocaleDateString()}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'details' && selectedScript && (
                            <div className="animate-fadeIn max-w-5xl mx-auto">
                                <button onClick={goHome} className="group flex items-center text-neutral-400 hover:text-white mb-6 gap-2 transition-colors px-3 py-1.5 rounded-full hover:bg-white/5 w-fit text-sm">
                                    <Icons.ArrowLeft size={14} /> 
                                    <span>返回列表</span>
                                </button>
                                
                                <div className="grid grid-cols-1 md:grid-cols-12 gap-8">
                                    {/* 左侧：信息与下载 (移动端在上) */}
                                    <div className="md:col-span-4 md:order-2 space-y-6 md:sticky md:top-24 h-fit">
                                        <div className="bg-[#1c1c1e] p-6 rounded-3xl border border-white/5 shadow-xl">
                                            <h1 className="text-2xl font-bold text-white mb-2">{selectedScript.title}</h1>
                                            <p className="text-indigo-400 text-sm font-medium mb-6 flex items-center gap-2">
                                                <span className="bg-indigo-500/10 px-2 py-0.5 rounded text-xs border border-indigo-500/20">作者</span> 
                                                {selectedScript.author}
                                            </p>
                                            
                                            <button onClick={() => handleDownload(selectedScript)} className="w-full bg-white hover:bg-neutral-200 text-black py-3 rounded-xl font-bold text-base flex justify-center items-center gap-2 transition-colors shadow-lg shadow-white/5">
                                                <Icons.FileJson /> 下载 JSON 剧本
                                            </button>

                                            <p className="mt-4 text-xs text-neutral-500 text-center leading-relaxed">
                                                下载 JSON 文件后，可直接导入魔典(Grimoire)或第三方在线车工具使用。
                                            </p>
                                        </div>
                                    </div>

                                    {/* 右侧：图片展示 (占据主要视觉) */}
                                    <div className="md:col-span-8 md:order-1 space-y-8">
                                        {/* 封面图 */}
                                        <div className="space-y-2">
                                            <h3 className="text-sm font-bold text-neutral-500 ml-2 uppercase tracking-wide">封面</h3>
                                            <div className="rounded-2xl overflow-hidden border border-white/5 shadow-2xl bg-[#1c1c1e]">
                                                {/* 保持原图清晰度，宽度撑满容器 */}
                                                <img src={selectedScript.frontImgUrl} className="w-full h-auto block" alt="封面" />
                                            </div>
                                        </div>

                                        {/* 角色表 */}
                                        <div className="space-y-2">
                                            <h3 className="text-sm font-bold text-neutral-500 ml-2 uppercase tracking-wide">角色表</h3>
                                            <div className="rounded-2xl overflow-hidden border border-white/5 shadow-2xl bg-[#1c1c1e]">
                                                <img src={selectedScript.backImgUrl} className="w-full h-auto block" alt="角色表" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    {/* 页脚 */}
                    <footer className="border-t border-white/5 mt-8 py-8 text-center bg-black">
                        <p className="text-neutral-500 text-sm">© 2025 Drunker.online</p>
                        <p className="text-neutral-600 text-xs mt-2 font-light">网站测试中，如有问题联系小红书 <span className="text-neutral-400 font-medium">@酒鬼说书人</span></p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>